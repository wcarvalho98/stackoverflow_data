---
title: "Análise sobre dados de desenvolvedores(as) ao redor do mundo"
author: "Christian Lira e Wilder Carvalho"
date: "`r Sys.Date()`"
output:
  rmdformats::material:
    css: ./styles.css
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE, cache=TRUE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("rlang", repos = "http://cran.us.r-project.org")
install.packages("rmdformats", repos = "http://cran.us.r-project.org")
install.packages("knitr", repos = "http://cran.us.r-project.org")
install.packages("stringr", repos = "http://cran.us.r-project.org")
install.packages("tidyverse", repos = "http://cran.us.r-project.org")
install.packages("kableExtra", repos = "http://cran.us.r-project.org")
install.packages("dplyr", repos = "http://cran.us.r-project.org")
install.packages("quantmod", repos = "http://cran.us.r-project.org")
install.packages("tidyr", repos = "http://cran.us.r-project.org")
install.packages("stringr", repos = "http://cran.us.r-project.org")
library(stringr)
library(rmdformats)
library(knitr)
library(rlang)
library(tidyverse)
library(kableExtra)
library(dplyr)
library(quantmod)
library(tidyr)
```

# Introdução {.tabset .title}

O Stack overflow é uma plataforma gratuita de perguntas e respostas para
programadores, estudantes e entusiastas em tecnologia e desenvolvimento.
Nele, qualquer usuário pode publicar uma dúvida para ser respondida por
outros membros do site. Além disso, a plataforma oferece classificados
de empregos na área de tecnologia.

## Importância {.sub-title}

Trabalhar com desenvolvimento de software exige conhecimento
multidisciplinar e estudo. É comum observar que pessoas novatas na área
sintam-se frustradas pela quantidade de assuntos paralelos que estão
envolvidos no aprendizado de uma "simples" linguagem de programação.

Para um programador Java, por exemplo, espera-se que ele tenha
conhecimento de versionamento de código, Programação Orientada a Objetos
(POO), modelagem de banco de dados, conexão a banco de dados, frameworks
entre diversos outros assuntos que se fossemos citar aqui seria uma
lista gigantesca.

É humanamente impossível, um indivíduo saber com perfeição todos os
tópicos que envolvem um fluxo de desenvolvimento de software. Entramos
na Universidade, achando que estamos 100% prontos para resolver qualquer
problema complexo no mercado de trabalho, mas a realidade não é essa.

No dia-a-dia no mercado de trabalho, bem como na universidade,
frequentemente desenvolvedores de todo o mundo recorrem à internet em
busca de dúvidas e, hoje, um dos ambientes mais utilizados é o Stack
Overflow, que serve como uma comunidade de programadores, um espaço em
que os profissionais/estudantes podem trocar dicas, elencar soluções e
esclarecer dúvidas sobre códigos.

Por ser uma das ferramentas mais utilizadas, com o propósito de troca de
conhecimento em programação. Esperamos, inferir através da comunidade de
usuários da plataforma, informações como: "Comparativo salarial dos
desenvolvedores ao redor do mundo", "Meios de aprendizagem mais
utilizados para aprendizado da programação", "Gêneros dos profissionais
de desenvolvimento por localidade", "Etnia dos profissionais vs Salário
médio", "Saúde mental dos profissionais".

## Origem dos dados {.sub-title}

Os dados são provenientes de uma plataforma que reúne diversas bases de
dados disponíveis publicamente e de forma gratuita sendo suficiente
realizar um cadastro na plataforma. A base de dados se encontra-se aqui:
[link do database stack-overflow
2022](https://www.kaggle.com/datasets/dheemanthbhat/stack-overflow-annual-developer-survey-2022).
Esse database possue diversas características relacionadas aos
desenvolvedores que responderam a pesquisa do StackOverflow em 2022.

Os dados variam desde a educação do desenvolvedor até o hobby dele.
Dessa maneira, iremos, neste projeto, realizar uma análise exploratória
dos dados extraindo características dos desenvolvedores como sua
educação, trabalho, salário entre outra(s) característica(s).

A partir disso iremos elencar os países desses desenvolvedores em um
conjunto de análises de maneira a visualizar pontos como salário médio
entre os desenvolvedores ao redor do mundo, educação dos desenvolvedores
por país, experiência de trabalho baseada no sexo e densidade de
profissionais em cada país.

Tais extrações possibilitam uma análise de mercado que pode auxiliar na
tomada de decisão de profissionais iniciantes na carreira do
desenvolvimento ou até mesmo quem pensa em fazer uma transição de
carreira.

# Pacotes Necessários {.tabset .title}

Os seguintes pacotes serão utilizados no projeto:

```{r echo=FALSE, warning=FALSE}
v <- c("library(stringr)","library(rmdformats)","library(knitr)","library(rlang)","library(tidyverse)","library(kableExtra)","library(dplyr)","library(quantmod)","library(tidyr)")
f <- c("Utilizada para manipulação de strings","Customização do template gerado pelo rmarkdown","Para geração de tabelas","Resolução de dependencias","Para manipulação avançada de DataFrames","Customização de tabelas do knitr::kable()","Para manipulação avançada de DataFrames","Utilizado para processamento de dados financeiros","Para manipulação avançada de DataFrames")

table <- data.frame(Pacotes=v,Utilização=f)
knitr::kable(table)
```

# Preparação dos dados {.tabset .title}

Nessa seção você encontrará com detalhes as operações que foram
realizadas para normalizar o *dataset*.

## Leitura do dataset {.sub-title}

A leitura do dataset foi realizada utilizando o seguinte comando, com a
base de dados baixada na máquina pessoal:

```{r message=FALSE, warning=FALSE}
dataset_path = "dataset/survey_results_public/survey_results_public.csv"
dataset <- read.csv(dataset_path)
```

Para realizar o download da base, assim como foi descrito na introdução,
baixa acessar esse
[link](https://www.kaggle.com/datasets/dheemanthbhat/stack-overflow-annual-developer-survey-2022).

### **Dados carregados**

O dataset possui **`r nrow(dataset)`** linhas e **`r ncol(dataset)`**
colunas. Inicialmente realizamos um tratamento para remover colunas que
só pussuem valores na da seguinte forma:

```{r message=FALSE, warning=FALSE, cache=TRUE}
dataset = dataset[colSums(!is.na(dataset)) > 0] %>% select(-ResponseId) %>% filter(MainBranch == "I am a developer by profession")
```

Após o tratamento, onde filtramos apenas pelas pessoas que exercem a
profissão de desenvolvedor, o dataset resultante ficou com
**`r nrow(dataset)`** linhas e **`r ncol(dataset)`** colunas. Para fim
de visualização dos dados, fizemos uma limpeza nos NA presentes sendo
dispostos da seguinte forma:

```{r echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
library(dplyr)
knitr::kable(head(na.omit(dataset))) %>% 
  kableExtra::kable_styling(bootstrap_options = c("responsive", "striped", "hover", "condensed")) %>% 
  kableExtra::scroll_box(width = "100%", height = "600px")
```

# Subsets e análise {.tabset .title}

A partir da limpeza inicial dos dados, eliminando NAs criaremos subsets
para facilitar a análise feita.

## Comparativo Salarial entre Profissionais por países {.sub-title}

Nessa primeira análise, faremos um novo pré processamento na base
inicialmente tratada. E criaremos um subset contendo as seguintes
colunas:

-   MainBranch -\> Que indica a linha de trabalho do usuário do
    StackOverflow, nesse caso estamos unicamente interessados naqueles
    que são desenvolvedores, então usaremos os que contém o valor **I am
    a developer by profession**

-   Country -\> País do usuário

-   Currency -\> Moeda em que é pago.

-   CompTotal -\> Quanto o usuário recebe como pagamento ao total.

-   CompFreq -\> Qual a frequência dessa compensação (mensal ou anual).

```{r message=FALSE, warning=FALSE}
firstData <- select(dataset, MainBranch, Country, Currency, CompTotal, CompFreq) %>% tidyr::drop_na()
```

Após isso, obtemos o seguinte subset:

```{r message=FALSE, warning=FALSE, results='asis'}
head(firstData) %>% 
  kableExtra::kable() %>% 
  kableExtra::kable_styling(bootstrap_options = c("responsive", "striped", "hover", "condensed"))
```

A partir desse subset inicial, precisamos converter os valores de
pagamento para uma moeda comum, para fins comparativos.

Nesse caso faremos a conversão para dólar **USD** e em seguida
converteremos todos os valores de pagamento para o tipo mensal
**Monthly**.

```{r message=FALSE, warning=FALSE}
library(stringr)
firstData$Currency <- unlist(lapply(firstData$Currency, str_extract, "^.{3}"))

from <- c("USD")

to <- as.list(levels(as.factor(firstData$Currency)))

rates <- tibble(from = from, 
                       to = to) %>% 
  mutate(getQuote(paste0(from, to, "=X")) %>% 
           select(rate = Last))

currencyCon <- function(x, from = "USD", to = "USD", lookup = rates) {
  str_replace_all(from, '"', '')
  values <- lookup$rate
  
  names(values) <- lookup$from

  values[to] / (values[from] / x)
}

for (row in 1:nrow(firstData)) {
    firstData[row, "CompTotal"] <- currencyCon(as.numeric(firstData[row, "CompTotal"]), from = firstData[row, "Currency"])
    #firstData[row, "Currency"] <- "USD"
    
    if(firstData[row, "CompFreq"] == "Monthly") {
        firstData[row, "CompTotal"] <- as.numeric(firstData[row, "CompTotal"]) * 12
        firstData[row, "CompFreq"] <- "Yearly"
    }

}
  
```

## Comparativo da educação dos desenvolvedores por país {.sub-title}

Nessa seção iremos fazer um comparativo do nível educacional dos
desenvolvedores baseado em seu país de nascença. Para isso teremos que
coletar as colunas "EdLevel" e "Country" as quais correspondem,
respectivamente, ao nível de educação e o país de origem do
desenvolvedor. O seguinte código ira gerar um subset com a educação de
cada desenvolvedor da base e uma correlação com seu país de origem:

```{r message=FALSE, warning=FALSE}
education_country <- dataset %>% select(EdLevel, Country) %>% drop_na()
```

Após isso, obtemos o seguinte subset:

```{r message=FALSE, warning=FALSE, results='asis'}
head(education_country) %>% 
  kable() %>% 
  kableExtra::kable_styling(bootstrap_options = c("responsive", "striped", "hover", "condensed"))
```

De maneira a facilitar a construção dos dados de forma visual, criaremos
um subset elencando apenas os 10 países com maior quantidade de
desenvolvedores da seguinte forma:

```{r message=FALSE, warning=FALSE}
education_country$EdLevel <- as.factor(education_country$EdLevel)
education_country$Country <- as.factor(education_country$Country)

countries <- as.list(levels(education_country$Country))
dev_by_country = data.frame()

for (row in 1:length(countries)) {
  dev_by_country[row, "Devs"] <- nrow(education_country %>% filter(Country == countries[row]))
  dev_by_country[row, "Country"] <- countries[row]
}

education_levels = as.list(levels(education_country$EdLevel))
dev_by_country = dev_by_country %>% arrange(desc(Devs)) %>% slice_head(n = 5)

data = data.frame()
for (education in education_levels) {
  for (country in dev_by_country$Country) {
    temp = data.frame(ed_level = education, country = country, 
                      count = nrow(education_country %>% 
                                     filter(EdLevel == education, 
                                            Country == country)))
    data = rbind(data, temp)
  }
}

colors = rainbow(5)
x = barplot(matrix(data$count, nrow = 5, ncol = 9), main="Relação países x nível educacional", names.arg=education_levels, xlab="Nível educacional", ylab="Quantidade de desenvolvedores", col=colors, beside = T, las=2,cex.names=0.65,cex.lab=0.65)

legend("topright",pch = 15,col=colors,legend=dev_by_country$Country)
```

## Qual a relação entre homens e mulheres na área de TI?

Nesta seção iremos fazer um comparativo entre homens e mulheres no mundo
do desenvolvimento. Para isso iremos tratar o nosso dataset de maneira a
remover todos as respostas inválidas (NA). Em seguida iremos extrair
diversos dados como a quantidade total de pessoas que declararam seu
sexo, a quantidade de homens e mulheres e analisar os seus efeitos na
área da tecnologia ao redor do mundo assim como tentar identificar
relações de causa e efeito nos cenários descobertos:

```{r message=FALSE, warning=FALSE}
gender_dataset = dataset %>% filter(!is.na(Gender)) %>%
  select(Gender, Trans, Sexuality, YearsCode, ConvertedCompYearly) %>%
  filter(ConvertedCompYearly <= 2000000 & ConvertedCompYearly > 1000) %>%
  drop_na()
gender_dataset = gender_dataset %>% filter(Gender == "Man" | Gender == "Woman", Trans == "Yes" | Trans == "No", Sexuality == "Straight / Heterosexual" | Sexuality == "Gay or Lesbian" | Sexuality == "Bisexual")
gender = data.frame(count = (gender_dataset %>% summarise(n()))[1,1], man_count = (gender_dataset %>% summarise(sum(Gender == "Man")))[1,1], woman_count = (gender_dataset %>% summarise(sum(Gender == "Woman")))[1,1])
gender$man.straight_count = (gender_dataset %>% filter(Gender == "Man", Sexuality == "Straight / Heterosexual") %>% summarise(n()))[1,1]
gender$woman.straight_count = (gender_dataset %>% filter(Gender == "Woman", Sexuality == "Straight / Heterosexual") %>% summarise(n()))[1,1]
gender$man.trans_count = (gender_dataset %>% filter(Gender == "Man", Trans == "Yes") %>% summarise(n()))[1,1]
gender$woman.trans_count = (gender_dataset %>% filter(Gender == "Woman", Trans == "Yes") %>% summarise(n()))[1,1]
```

Primeiramente podemos fazer uma análise básica a respeito do mercado de
tecnologia: a distribuição de homens e mulheres que responderam à
pesquisa. No gráfico a seguir podemos ver como se comporta esses dados:

```{r message=FALSE, warning=FALSE}
library(ggplot2)

# Criação do data frame para o gráfico
data <- data.frame(
  group=c("Homem", "Mulher"),
  value=c(gender$man_count, gender$woman_count)
)

# Computação das posições dos labels no gráfico
data <- data %>% 
  arrange(desc(group)) %>%
  mutate(prop = value / sum(data$value)*100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop) %>%
  mutate(percentage = paste(round((value / gender$count) * 100, 2), "%", sep = ""))

# Criação do gráfico de pizza
ggplot(data, aes(x="", y=prop, fill=group)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() + 
  theme(legend.position="right") +
  labs(fill="Genero") +
  geom_text(aes(y=ypos, label=percentage), color = "white", size=5) +
  scale_fill_brewer(palette="Set1")
```

É visível a discrepância entre homens e mulheres na área de tecnologia.
Infelizmente isso se reflete na área em si onde é observável uma grande
quantia de homens em detrimento das mulheres, fruto de uma ideologia de
desigualdade de gênero ao redor do mundo como podemos observar nessa
[matéria](https://www.computerweekly.com/br/reportagen/Estatisticas-sobre-mulheres-em-tecnologia-Ultimas-pesquisas-e-tendencias "Estatística sobre mulheres em tecnologia").

Entretanto, para entendermos a razão desse cenário de desigualdade
precisamos investigar as relações de causa e efeito que tornam isso uma
realidade. Para isso irei analisar o tempo de experiência médio entre o
público feminino e masculino assim como a média salarial:

```{r message=FALSE, warning=FALSE}
library(ggplot2)

# Criação do data frame para o gráfico
data <- data.frame(
  group=c("Homem", "Mulher"),
  value=c((gender_dataset %>% filter(Gender == "Man") %>% summarise(mean(ConvertedCompYearly)))[1,1], (gender_dataset %>% filter(Gender == "Woman") %>% summarise(mean(ConvertedCompYearly)))[1,1]),
  exp_mean=c((gender_dataset %>% filter(Gender == "Man") %>% summarise(mean(as.integer(YearsCode), na.rm = T)))[1,1],
             (gender_dataset %>% filter(Gender == "Woman") %>% summarise(mean(as.integer(YearsCode), na.rm = T)))[1,1]))

data$value = round(data$value / 1000, 2)
data$exp_mean = round(data$exp_mean, 2)

colors = rainbow(2)
barplot(as.matrix(data %>% select(-group)), main="Comparativo salário médio x experiência média",names.arg=c("Salario (x1000)", "Experiencia"), ylab="Quantidade", col=colors, beside = T)

legend("topright",pch = 15,col=colors,legend=data$group)
```

### **Análise de comportamento**

Nos gráficos acima podemos visualizar que, enquanto temos uma grandia
quantia de homens na área de TI, as mulheres representam uma parcela
quase inexistente. Ao vermos como se comporta o gráfico salarial médio
podemos notar que as mulheres recebem bem menos que os homens no
comparativo anual enquanto possuem um tempo de experiência médio se
comparado aos homens.

Claramente isso torna a área menos atrativa para as mulheres que, não só
são desestimuladas no nível social a exercerem profissões relacionadas a
TI assim como elas tendem a ganhar menos mesmo quando possuem um tempo
de experiência igual ou próximo ao de um homem.
